<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema AcadÃªmico</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #1f1f1f; padding: 15px; text-align: center; border-bottom: 1px solid #333; font-size: 0.9em; color: #888; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 18px; line-height: 1.4; animation: fadeIn 0.3s ease; }
        .msg.outra { background: #333; align-self: flex-start; border-bottom-left-radius: 2px; }
        .msg.minha { background: #007bff; align-self: flex-end; border-bottom-right-radius: 2px; }
        .nome-label { font-size: 0.75em; font-weight: bold; margin-bottom: 3px; display: block; color: #aaa; }
        .hora { font-size: 0.65em; opacity: 0.7; margin-left: 8px; }
        footer { padding: 15px; background: #1f1f1f; display: flex; gap: 10px; }
        input { flex: 1; background: #2c2c2c; border: none; padding: 12px; border-radius: 25px; color: white; outline: none; }
        button { background: #007bff; border: none; width: 45px; height: 45px; border-radius: 50%; color: white; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>Portal do Aluno - Sala de Estudos Privada</header>
<div id="chat"></div>

<footer>
    <input type="text" id="texto" placeholder="Mande uma mensagem..." onkeypress="if(event.key === 'Enter') enviar()">
    <button onclick="enviar()">></button>
</footer>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA-xcHKzOr7-SmK6QH3FBSnwtoDJKXpDWs",
        authDomain: "meuchatamigos.firebaseapp.com",
        databaseURL: "https://meuchatamigos-default-rtdb.firebaseio.com",
        projectId: "meuchatamigos",
        storageBucket: "meuchatamigos.appspot.com",
        messagingSenderId: "1851389516796",
        appId: "1:1851389516796:web:13b07face0b1d7bae6f479"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const meuNome = prompt("Nome do Aluno:");
    const senhaAcesso = prompt("Senha de Acesso:");
    if (senhaAcesso !== "0502") {
        alert("Acesso Negado!");
        window.location.reload(); 
    }

    // PEDIR PERMISSÃƒO PARA NOTIFICAÃ‡Ã•ES NA BARRA
    if (Notification.permission !== "granted") {
        Notification.requestPermission();
    }

    function enviar() {
        const campo = document.getElementById("texto");
        const msg = campo.value;
        const agora = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
        if(msg.trim()) {
            db.ref("mensagens").push({ nome: meuNome, texto: msg, hora: agora });
            campo.value = "";
        }
    }

    let carregandoInicial = true;
    db.ref("mensagens").on("child_added", (snap) => {
        const d = snap.val();
        const chat = document.getElementById("chat");
        const div = document.createElement("div");
        const classeMsg = d.nome === meuNome ? "minha" : "outra";
        
        div.className = `msg ${classeMsg}`;
        div.innerHTML = `<span class="nome-label">${d.nome}</span>${d.texto}<span class="hora">${d.hora}</span>`;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;

        // NOTIFICAÃ‡ÃƒO NA BARRA DE TAREFAS
        if (!carregandoInicial && d.nome !== meuNome) {
            document.title = "ðŸ”´ Nova Mensagem!";
            if (Notification.permission === "granted") {
                new Notification("Chat Escola", { body: d.nome + ": " + d.texto });
            }
            setTimeout(() => { document.title = "Sistema AcadÃªmico"; }, 3000);
        }
    });

    db.ref("mensagens").once("value", () => { carregandoInicial = false; });
</script>
</body>
</html>
